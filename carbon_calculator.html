<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name='api-url' content='http://localhost:3001/api/calculate'>
  <title>Carbon Emission Estimator | Breathe Green</title>
  <link rel="stylesheet" href="carbon_calculator.css" />
</head>
<body>
  <nav class="navbar">
    <div class="logo"> <span>Breathe Green</span></div>
    <ul class="nav-links">
      <li><a href="nav_bar.html">Home</a></li>
      <li><a href="eco_liberary.html">Eco Library</a></li>
        <li><a href="carbon_calculator.ht ml">Carbon Emission Calculator</a></li>

    </ul>
  </nav>


  <section class="form-section">
    <h1>Carbon Emission Estimator</h1>
    <p style="text-align:center;">Select who you want to calculate for:</p>


    <div class="choice-buttons">
      <button id="individualBtn"> Individual</button>
      <button id="familyBtn"> Family</button>
    </div>


    <form id="individualForm" class="vertical-form" style="display:none;">
      <h2>Individual Data</h2>

      <label>Travel Mode:</label>
      <select id="travelMode">
        <option value="car">Car</option>
        <option value="ev">EV</option>
        <option value="bus">Bus</option>
        <option value="train">Train</option>
        <option value="scooter">Scooter</option>
        <option value="walk">Walk</option>
        <option value="cycle">Cycle</option>
      </select>

      <label>Distance Travelled (km/month):</label>
      <input type="number" id="travelKm" required>

      <label>Diet Type:</label>
      <select id="diet">
        <option value="veg">Vegetarian</option>
        <option value="mixed">Mixed</option>
        <option value="meat">Non-Vegetarian</option>
      </select>

      <label>Electricity Usage (kWh/month):</label>
      <input type="number" id="kWh" required>

      <label>Waste Produced (kg/month):</label>
      <input type="number" id="waste" required>

      <button type="button" id="calcIndividual">Send Data</button>
    </form>


    <form id="familyForm" class="vertical-form" style="display:none;">
      <h2>Family Data</h2>

      <label>Total Family Members:</label>
      <input type="number" id="familyMembers" required>

      <label>Number of Vehicles:</label>
      <input type="number" id="vehicles" required>

      <label>Vehicle Type:</label>
      <select id="vehicleType">
        <option value="petrol">Petrol</option>
        <option value="ev">EV</option>
        <option value="diesel">diesel</option>
      </select>

      <label>Average Travel per Month (km per vehicle):</label>
      <input type="number" id="familyTravelKm" required>

      <label>Electricity Usage (kWh/month):</label>
      <input type="number" id="familyKwh" required>

      <label>Waste Produced (kg/month):</label>
      <input type="number" id="familyWaste" required>

      <label>Average Diet Type:</label>
      <select id="familyDiet">
        <option value="veg">Vegetarian</option>
        <option value="mixed">Mixed</option>
        <option value="meat">Non-Vegetarian</option>
      </select>

      <button type="button" id="calcFamily">Send Data</button>
    </form>

    <div id="result" style="margin-top:30px; text-align:center;"></div>
  </section>

  <script>
const API_URL = "/api/calculate"; // relative path for same-repo Vercel deployment

async function postPayload(payload) {
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(`Server ${res.status}: ${text}`);
    }
    return await res.json();
  } catch (err) {
    console.error("API error:", err);
    throw err;
  }
}

// Individual
document.getElementById("calcIndividual").addEventListener("click", async () => {
  const payload = {
    type: "individual",
    travelMode: document.getElementById("travelMode").value,
    travelKm: Number(document.getElementById("travelKm").value || 0),
    // backend accepts `diet` -> mapped to foodCategory
    diet: document.getElementById("diet").value,
    kWh: Number(document.getElementById("kWh").value || 0),
    waste: Number(document.getElementById("waste").value || 0)
  };
  try {
    const data = await postPayload(payload);
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (e) {
    document.getElementById("result").innerHTML = `<p style="color:red">Error: ${e.message}</p>`;
  }
});

// Family
document.getElementById("calcFamily").addEventListener("click", async () => {
  const payload = {
    type: "family",
    members: Number(document.getElementById("familyMembers").value || 0),
    vehicles: Number(document.getElementById("vehicles").value || 0),
    vehicleType: document.getElementById("vehicleType").value,
    familyTravelKm: Number(document.getElementById("familyTravelKm").value || 0),
    familyKwh: Number(document.getElementById("familyKwh").value || 0),
    familyWaste: Number(document.getElementById("familyWaste").value || 0),
    familyDiet: document.getElementById("familyDiet").value
  };
  try {
    const data = await postPayload(payload);
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
  } catch (e) {
    document.getElementById("result").innerHTML = `<p style="color:red">Error: ${e.message}</p>`;
  }
});
  </script>
</body>
</html>
